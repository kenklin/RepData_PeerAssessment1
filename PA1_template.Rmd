---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---


## Loading and preprocessing the data
1. The following code loads the data into the `activity` dataframe.
```{r}
library(dplyr, warn.conflicts=FALSE)
library(ggplot2)
library(scales)
activity <- read.csv("activity.csv")
```

2. Use `activity$interval` (hhmm) to create a `tod` variable (time on epoch day 1) which will be useful for interval displays.
```{r}
activity$tod <- ISOdate(year=1970, month=1, day=1,
    hour=activity$interval %/% 100,
    min=activity$interval %% 100)
```



## What is mean total number of steps taken per day?
1. This histogram plots the frequency of total number of steps taken each day, which is calculated and stored in `stepsByDate`.  Per the instructions, missing values in `activity` are *ignored*.  Rather than using the default binwidth of `diff(range(stepsByDate$totsteps))/30` (705.1), a more natural `bwidth` of 500 is used.
```{r}
# Function that returns a new steps-by-date dataframe from 'activity'
# with a new 'totsteps' variable.  Missing value rows are omitted.
createStepsByDate <- function(dfActivity) {
  na.omit(dfActivity) %>% group_by(date) %>% summarise(totsteps=sum(steps))
}

# Function that returns a steps-by-date histogram.
plotStepsByDate <- function(stepsByDate, title) {
  #bwidth <- diff(range(stepsByDate$totsteps)) / 30
  bwidth <- 500
  plot <- ggplot(data=stepsByDate, aes(x=totsteps)) +
    geom_histogram(binwidth=bwidth) +
    ggtitle(title) +
    xlab(paste0("Steps/Day (binwidth=", bwidth, ")")) +
    ylab("Frequency")
  return(plot)
}
```
```{r}
stepsByDate <- createStepsByDate(activity)
plotStepsByDate(stepsByDate, "Frequency of Steps per Day")
```

2. The (integer) mean and median total number of steps taken per day are calculated with this code:
```{r}
stepsMean <- round(mean(stepsByDate$totsteps), digits=2)
stepsMedian <- as.integer(median(stepsByDate$totsteps))
```
The mean is ``r as.character(stepsMean)`` and the median is ``r stepsMedian``.



## What is the average daily activity pattern?
1. This time series plot has the 5-minute interval (x-axis) and the average number of steps taken, averaged across all days (y-axis).  Missing values in `activity` are ignored.  As a reader aid, interval values have been converted to time of day in `activity$tod`.
```{r}
stepsByTimeOfDay <- na.omit(activity) %>%
    group_by(tod, interval) %>%
    summarise(totsteps=mean(steps))
ggplot(data=stepsByTimeOfDay, aes(x=tod, y=totsteps)) +
    geom_line() +
    ggtitle("Average Steps vs. Time of Day") +
    xlab("Time of Day (5-min intervals)") +
    scale_x_datetime(labels=date_format("%H:%M"),
                     breaks=date_breaks("2 hour")) +
    ylab("Average Steps (across all days)")
```

2. The following code determines which 5-minute interval, on average across all the days in the dataset, contains the maximum number of steps.
```{r}
maxStepsIndex <- which.max(stepsByTimeOfDay$totsteps)
maxSteps <- as.integer(stepsByTimeOfDay[maxStepsIndex, "totsteps"])
maxStepsInterval <- stepsByTimeOfDay[maxStepsIndex, "interval"]
maxStepsTimeOfDay <- format(stepsByTimeOfDay[maxStepsIndex, "tod"], format="%H:%M")
```
The maximum number of steps (`r maxSteps`) occurs at 5-minute interval ``r maxStepsInterval`` (`r maxStepsTimeOfDay`).



## Imputing missing values
1. The following calculates the total number of rows in `activity` containing NAs ...
```{r}
numNA <- sum(is.na(activity$steps))
```
The number of NA rows is ``r numNA``.

2. My strategy to fill in all missing (NA) values in the dataset is to use the **mean for that 5-minute interval, previously determined in `stepsByTimeOfDay$totsteps`**.  This was one of the possible strategies suggested in the assignment directions "or the mean for that 5-minute interval, etc."

3. The code below shows how the new `imputed.activity` dataset is created from `activity`, where NA `steps` values are replaced by the mean for that 5-minute interval, which was previously determined in `stepsByTimeOfDay$totsteps`.
```{r}
# Initialize imputed.activity with activity
imputed.activity <- activity

# Iterate over rows, replacing missing steps with imputed values
for (i in 1:nrow(imputed.activity)) {
  if (is.na(imputed.activity[i, "steps"])) {
    # Determine the interval of the missing steps
    interval <- imputed.activity[i, "interval"]
    
    # Imputed steps are the mean for that 5-min interval.  Since this has already
    # been determined in stepsByTimeOfDay$totsteps, lookup the row by interval.
    imputedSteps <- stepsByTimeOfDay[stepsByTimeOfDay$interval==interval, "totsteps"]
    
    # Overwrite missing steps with the imputed value
    imputed.activity[i, "steps"] <- imputedSteps
  }
}
```



4. A histogram of the total number of steps taken each day is made by calling the previously defined function with `imputed.activity`.
```{r}
imputed.stepsByDate <- createStepsByDate(imputed.activity)
plotStepsByDate(imputed.stepsByDate, "Frequency of (Imputed) Steps per Day")
imputedNumNA <- sum(is.na(imputed.activity$steps))
```
The number of NA rows is ``r imputedNumNA``.

This code again calculates the mean and median total number of steps taken per day.
```{r}
imputed.stepsMean <- round(mean(imputed.stepsByDate$totsteps), digits=2)
imputed.stepsMedian <- as.integer(median(imputed.stepsByDate$totsteps))
```
The mean is ``r as.character(imputed.stepsMean)`` and the median is ``r imputed.stepsMedian`` for the imputed data.

#### Observations
- The two histograms visually appear the same.
- The two *mean* calculations remain the same ``r as.character(imputed.stepsMean)``.  In hindsight, this is to be expected since the chosen strategy of replacing the missing step values with the mean of non-missing values doesn't change the mean!
- The *median* however does shift slightly from ``r stepsMedian`` to ``r imputed.stepsMedian`` due to the increase in observations when imputed data is used.



## Are there differences in activity patterns between weekdays and weekends?
